<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <link rel="stylesheet" href="{% static 'nd.css' %}">

    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
    <link rel="icon" href="{% static 'Images and icons/—Pngtree—village house logo real estate_3628984.png' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Details</title>
</head>

<body>
    <!--/*=================== top-bar ==================*/-->

    <section class="top-bar">
        <div class="left-options">
            <div class="logo">
                <img class="logo-img" id="limg" src="{% static 'photos/AVARLOGO.svg' %}" alt="logo-img">
                <img class="small-logo" alt="small-logo" src="{% static 'photos/avarsmalllogo .svg' %}">
            </div>
        </div>
        <div class="right-options">
 {% if not user.is_authenticated %}
            <a href="{% url 'home:login' %}" id="login">تسجيل الدخول </a>
            {% else %}

             <a href="{% url 'home:newres' %}" id="login">اضافة عقار</a>
            {% endif %}            <img class="clickable-img" src="{% static 'photos/men.png' %}" id="myImage" alt="menu-img">
        </div>


        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <ul class="links">
                   <a href="{% url 'home:main' %}">
                    <div class="homeli lin">
                        <li>الصفحة الرئيسية</li>
                        <div class="ll1"><img class="home-img" src="{% static 'photos/home-page.png' %}" alt="home-img"></div>
                    </div>
                       </a>
                    <a href="{% url 'home:myprofile' %}">
                             <div class="profileli lin ">
                                 <li>الملف الشخصي</li>
                            <div class="ll1"><img class="profile-img" src="{% static 'photos/male-user.png' %}" alt="profile-img"></div>
                         </div>
                    </a>
                    <a href="{% url 'home:myprofile' %}?filter=عقاراتي ">
                    <div class="estateli lin ">
                       <li> عقاراتي</li>
                        <div class="ll2"><img class="estate-img" src="{% static 'photos/real-estate.png' %}" alt="estate-img"></div>
                    </div>
                    </a>
                    <a href="{% url 'home:myprofile' %}?filter=حجوزاتي">
                        <div class="reservationli lin">
                            <li> حجوزاتي</li>
                                <div class="ll2"><img class="reservation-img" src="{% static 'photos/reservation.png' %}"
                                alt="reservation-img"></div>
                        </div>
                    </a>
                    <a href="{% url 'home:gallery' %}">
                         <div class="checkli lin">
                                <li>احجز الان</li>
                            <div class="ll2"><img class="check-img" src="{% static 'photos/check-book.png' %}" alt="check-img"></div>
                         </div>
                    </a>
                    <a href="{% url 'home:help' %}">
                         <div class="contact-usli lin">
                                <li>تواصل معنا</li>
                             <div class="ll3"><img class="contact-img" src="{% static 'photos/contact-us.png' %}" alt="contact-img"></div>
                            </div>
                    </a>
                     {% if user.is_authenticated %}
                    <a href="{% url 'home:logout' %}">
                    <div class="logoutli lin">
                            <li>تسجيل الخروج</li>
                                <div class="ll4"><img class="logout-img" src="{% static 'photos/logout.png' %}" alt="logout-img"></div>
                            </div>
                    </a>
                    {% endif %}
                </ul>
            </div>
        </div>
        <div id="myModal2" class="modal2">
            <div class="modal-content2">
                <span class="close-btn2">&times;</span>
                <div class="selects">
                    <div class="select0">

                        <select name="Aqar" id="Aqar" required>

                            <option value="">اختيار نوع العقار</option>
                            <option value="">مزارع</option>
                            <option value="">شقق</option>
                            <option value="">مسابح</option>
                            <option value="">فيلات</option>

                        </select>
                    </div>
                    <div class="select1">

                        <select name="city" id="city" required>
                            <div class="select1">
                                <option value="">اختيار محافظة</option>
                                <option value="edleb">ادلب</option>
                                <option value="aleppo">حلب</option>
                                <option value="damascus">دمشق</option>
                                <option value="ref">ريف دمشق </option>
                                <option value="hama">حماه</option>
                                <option value="homs">حمص</option>
                                <option value="daraa">درعا</option>
                                <option value="alqunaetera"> القنيطرة</option>
                                <option value="alsuadia">السويداء</option>
                                <option value="alder">دير الزور</option>
                                <option value="alqameshli">الرقة</option>
                                <option value="alhasaka">الحسكة</option>
                                <option value="latakia">اللاذقية</option>
                                <option value="tartus">طرطوس</option>

                        </select>
                    </div>
                    <div class="select2">

                        <select name="Madena" id="Madena" required>

                            <option value="">اختيار مدينة أو بلدة</option>
                            <option value="">برزة</option>


                        </select>
                    </div>
                    <div class="select3">

                        <select name="Alser" id="Alser" required>

                            <option value="">اختيار الحد الاعلى</option>
                            <option value="">50$</option>
                            <option value="">100$</option>
                            <option value="">150$</option>
                            <option value="">200$</option>
                            <option value="">250$</option>
                            <option value="">300$</option>
                            <option value="">350$</option>
                            <option value="">400$</option>
                            <option value="">450$</option>
                            <option value="">500$</option>
                            <option value="">600$</option>
                            <option value="">700$</option>
                            <option value="">800$</option>
                            <option value="">900</option>
                            <option value="">1000$</option>

                        </select>
                    </div>
                </div>

            </div>
        </div>
        <script>
            var modal2 = document.getElementById('myModal2');

            // Get the image and insert it inside the modal
            var img2 = document.getElementById('mySearch');
            var modalContent2 = document.querySelector('.modal-content2');

            // Get the <span> element that closes the modal
            var closeBtn2 = document.querySelector('.close-btn2');

            // When the user clicks the image, open the modal
            img2.onclick = function () {
                modal2.style.display = 'block';
            }
            // When the user clicks on <span> (x), close the modal
            closeBtn2.onclick = function () {
                modal2.style.display = 'none';
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event1) {
                if (event1.target == modal2) {
                    modal2.style.display = 'none';
                }
            }
        </script>
        <script src="{% static 'details3.js' %}"></script>
    </section>

    <!--/*=================== gallary ==================*/-->
    <div class="i"></div>

    <div class="regnimgs">
        <div class="regbox">
            <span class="regdetailsword">: تفاصيل الحجز </span>
            <span class="cost"> <span> التكلفة :</span>
                <span> $400 </span>
                <span>بالليلة</span>
            </span>
            <button class="regg" id="showCalendar">احجز الان</button>
        </div>

        <div class="imgs">

            <div class="image-container" id="imageContainer">
                <img class="active" src="{% static 'photos/22.jpg' %}" alt="صورة 1">
                <img src="{% static 'photos/11.jpg' %}" alt="صورة 2">
                <img src="{% static 'photos/33.jpg' %}" alt="صورة 3">
                <!-- أضف المزيد من الصور هنا -->
            </div>
            <div class="btns">
                <div class="btn prev" id="prev"></div>
                <div class="btn next" id="next"></div>
            </div>


            <script>
                const images = document.querySelectorAll('.image-container img');
                let currentIndex = 0;

                // عرض الصورة الأولى
                images[currentIndex].classList.add('active');

                document.getElementById('prev').onclick = function () {
                    images[currentIndex].classList.remove('active'); // إخفاء الصورة الحالية
                    currentIndex = (currentIndex > 0) ? currentIndex - 1 : images.length - 1; // الانتقال إلى الصورة السابقة
                    images[currentIndex].classList.add('active'); // عرض الصورة الجديدة
                };

                document.getElementById('next').onclick = function () {
                    images[currentIndex].classList.remove('active'); // إخفاء الصورة الحالية
                    currentIndex = (currentIndex < images.length - 1) ? currentIndex + 1 : 0; // الانتقال إلى الصورة التالية
                    images[currentIndex].classList.add('active'); // عرض الصورة الجديدة
                };
            </script>
        </div>
        <div class="overlay" id="overlay"></div>

    </div>

    <!--/*===================  calendre  ==================*/-->

    <!-- Calendar Modal -->
    <div class="calendar-modal" id="calendarModal">
        <div class="calendar" id="calendarContainer">
            <div class="month-year">
                <span class="arrow" id="prevMonth">&lt;</span>
                <span class="month-name" id="monthName"></span>, <span class="year-name" id="yearName"></span>
                <span class="arrow" id="nextMonth">&gt;</span>
            </div>
            <div class="weekdays">
                <div class="weekday">الأحد</div>
                <div class="weekday">الاثنين</div>
                <div class="weekday">الثلاثاء</div>
                <div class="weekday">الأربعاء</div>
                <div class="weekday">الخميس</div>
                <div class="weekday">الجمعة</div>
                <div class="weekday">السبت</div>
            </div>
            <div class="days" id="daysContainer"></div>
        </div>
        <div class="cal_details">
            <span><span class="av">الأيام </span>المتاحة</span>
            <span><span class="not-av">الأيام </span>الغير متاحة</span>
            <span><span class="reg">الأيام </span>التي تريد حجزها</span>
        </div>
        <div class="cal-buttons">
            <button class="close-button" id="closeCalendar">إغلاق</button>
            <button class="cal-confirm-button" id="confirmSelection">تأكيد</button>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" style="display: none;"></div>

    <!-- Reservation Confirmation Popup -->
    <div class="pop" id="pop" style="display: none;">
        <div class="pop-content">
            <h1>تأكيد الحجز</h1>
            <div class="cost-conf">
                <span class="cost-conf-text">:ان المبلغ الذي سيترتب عليك دفعه هو </span>
                <span class="cost-conf-num"></span>
            </div>
            <br>
            <div class="warning">
                <div class="warning-word">تنبيه</div>
                <div class="warning-text"></div>
            </div>
            <div class="pop-buttons">
                <button id="conf">موافق</button>
                <button id="cancel">إلغاء</button>
            </div>
        </div>
    </div>

    <!-- Success Popup -->
    <div class="pop" id="success-pop" style="display: none;">
        <div class="pop-content">
            <p>تم استلام طلبك بنجاح سيتم التواصل معك لتأكيد الحجز</p>
            <div class="pop-buttons">
                <button id="close-success">إغلاق</button>
            </div>
        </div>
    </div>

    {% csrf_token %}

    <!-- JavaScript code -->
    <script>
        const months = [
            "كانون الثاني", "شباط", "آذار", "نيسان", "أيار", "حزيران",
            "تموز", "آب", "أيلول", "تشرين الأول", "تشرين الثاني", "كانون الأول"
        ];

        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        let selectedDays = []; // Stores formatted date strings
        let firstSelectedDate = null;
        let secondSelectedDate = null;

        // Get reserved dates from the Django view
        const reservedDates = {{ reserved_dates|safe }};

        function formatDate(date) {
            let year = date.getFullYear();
            let month = (date.getMonth() + 1).toString().padStart(2,'0');
            let day = date.getDate().toString().padStart(2,'0');
            return `${year}-${month}-${day}`;
        }

        function createCalendar(month, year) {
            const daysContainer = document.getElementById('daysContainer');
            const monthNameElem = document.getElementById('monthName');
            const yearNameElem = document.getElementById('yearName');
            daysContainer.innerHTML = '';

            monthNameElem.textContent = months[month];
            yearNameElem.textContent = year;

            const daysInMonth = new Date(year, month + 1, 0).getDate(); // Total days in month
            const firstDay = new Date(year, month, 1).getDay(); // First day of the month

            // Adjust for Arabic week starting on Sunday (if needed)
            const adjustedFirstDay = (firstDay + 6) % 7;

            // Add blank days for alignment
            for (let i = 0; i < adjustedFirstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day empty';
                daysContainer.appendChild(emptyDay);
            }

            // Today's date for comparison
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Reset time for accurate comparison

            for (let day = 1; day <= daysInMonth; day++) {
                const dayDate = new Date(year, month, day);
                dayDate.setHours(0, 0, 0, 0); // Reset time
                const formattedDate = formatDate(dayDate);

                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                dayElement.textContent = day;
                dayElement.setAttribute('data-date', formattedDate); // Add data attribute

                // Check if the date is in the past
                if (dayDate < today) {
                    dayElement.classList.add('unavailable');
                } else if (reservedDates.includes(formattedDate)) {
                    dayElement.classList.add('unavailable');
                } else {
                    dayElement.classList.add('available');
                    // Check if the date is already selected
                    if (selectedDays.includes(formattedDate)) {
                        dayElement.classList.add('selected');
                    }
                    // Add click event
                    dayElement.addEventListener('click', () => {
                        handleDateSelection(dayDate);
                    });
                }

                daysContainer.appendChild(dayElement);
            }
        }

        function handleDateSelection(dayDate) {
            if (!firstSelectedDate) {
                // First date selected
                resetSelections();
                firstSelectedDate = dayDate;
                selectedDays = [formatDate(firstSelectedDate)];
            } else if (!secondSelectedDate) {
                // Second date selected
                secondSelectedDate = dayDate;

                // Ensure the first date is earlier than the second
                if (secondSelectedDate < firstSelectedDate) {
                    [firstSelectedDate, secondSelectedDate] = [secondSelectedDate, firstSelectedDate];
                }

                // Select all dates between firstSelectedDate and secondSelectedDate
                selectDateRange(firstSelectedDate, secondSelectedDate);
            } else {
                // Reset and start over
                resetSelections();
                firstSelectedDate = dayDate;
                selectedDays = [formatDate(firstSelectedDate)];
                secondSelectedDate = null;
            }

            // Refresh calendar to reflect selections
            createCalendar(currentMonth, currentYear);
        }

        function selectDateRange(startDate, endDate) {
            selectedDays = [];

            let currentDate = new Date(startDate);
            currentDate.setHours(0, 0, 0, 0); // Reset time

            endDate.setHours(0, 0, 0, 0); // Reset time

            while (currentDate <= endDate) {
                const currentFormattedDate = formatDate(currentDate);
                selectedDays.push(currentFormattedDate);

                currentDate.setDate(currentDate.getDate() + 1);
            }
        }

        function resetSelections() {
            selectedDays = [];
            firstSelectedDate = null;
            secondSelectedDate = null;
        }

        function showCalendar() {
            createCalendar(currentMonth, currentYear);
            document.getElementById('calendarModal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block'; // Show the overlay
        }

        function closeCalendar() {
            document.getElementById('calendarModal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none'; // Hide the overlay
            resetSelections(); // Reset selected days
        }

        // Event listeners
        document.getElementById('showCalendar').addEventListener('click', showCalendar);
        document.getElementById('closeCalendar').addEventListener('click', closeCalendar);
        document.getElementById('overlay').addEventListener('click', closeCalendar);

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth = (currentMonth - 1 + 12) % 12;
            if (currentMonth === 11) {
                currentYear--;
            }
            createCalendar(currentMonth, currentYear);
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth = (currentMonth + 1) % 12;
            if (currentMonth === 0) {
                currentYear++;
            }
            createCalendar(currentMonth, currentYear);
        });

        // Handle reservation confirmation
        document.getElementById('confirmSelection').addEventListener('click', function(event) {
            event.preventDefault();

            if (selectedDays.length === 0) {
                alert('الرجاء اختيار تاريخين.');
                return;
            }

            // Get start_date and end_date
            selectedDays.sort(); // Ensure dates are in order
            const start_date = selectedDays[0];
            const end_date = selectedDays[selectedDays.length - 1];

            fetch("{% url 'home:resProfile' slug=real_estate.slug %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({
                    'action': 'reserve_dates',
                    'start_date': start_date,
                    'end_date': end_date
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Display the total price and warning message
                    document.querySelector('.cost-conf-num').textContent = data.total_price + '$';
                    document.querySelector('.warning-text').textContent = data.warning;
                    document.getElementById('pop').style.display = 'flex';
                    // Close the calendar modal
                    closeCalendar();
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        // Handle final confirmation
        document.getElementById('conf').addEventListener('click', function() {
            document.getElementById('pop').style.display = 'none';
            document.getElementById('success-pop').style.display = 'flex';
        });

        document.getElementById('cancel').addEventListener('click', function() {
            document.getElementById('pop').style.display = 'none';
        });

        document.getElementById('close-success').addEventListener('click', function() {
            document.getElementById('success-pop').style.display = 'none';
        });

        // Initialize calendar on page load
        document.addEventListener('DOMContentLoaded', function() {
            createCalendar(currentMonth, currentYear);
        });
    </script>

    <!-- Include CSS styles -->
    <style>
        /* Your existing styles */

        /* Styles for the calendar */
        .day.available {
            /* Your existing styles for available days */
        }
        .day.unavailable {
            /* Your existing styles for unavailable days */
        }
        .day.selected {
            /* Your existing styles for selected days */
        }

        /* Styles for pop-ups */
        .pop {
            /* Your existing styles */
        }

        /* Other styles */
    </style>




    <!--/*=================== table ==================*/-->
    <div class="info">
        <table class="info-table">
            <tr class="header-row">
                <th colspan="2" class="h" id="head1">معلومات العقار </th>

            </tr>
            <tr class="data-row">
                <td class="l"> </td>
            </tr>
            <tr class="data-row">
  <td class="l star-table-place">
   <div class="stars-table">
    <!-- Full Stars -->
    {% for _ in full_stars %}
        <span class="star-table star-full">&#9733;</span>
    {% endfor %}

    <!-- Half Star -->
    {% for _ in half_stars %}
        <span class="star-table star-half">&#9733;</span> <!-- Or use a half-star icon -->
    {% endfor %}

    <!-- Empty Stars -->
<!--    {% for _ in empty_stars %}-->
<!--        <span class="star-table star-empty">&#9734;</span>-->
<!--    {% endfor %}-->

    <!-- Optional: Display average rating numerically -->
</div>

</td>
<td class="r"> التقييم</td>

<!-- Include CSS to style the stars appropriately -->
<style>
    .star-full {
        color: gold;
    }
    .star-half {
        color: gold;
        position: relative;
        display: inline-block;
        overflow: hidden;
        width: 0.5em; /* Adjust as needed */
    }
    .star-half::before {
        content: '\2605'; /* Unicode for star character */
        color: gold;
        position: absolute;
        left: 0;
        width: 1em; /* Adjust as needed */
        overflow: hidden;
    }
</style>

            </tr>
            <tr class="data-row">
                <td class="l"> </td>
            </tr>
            <tr class="data-row">
                <td class="l">الربيع </td>
                <td class="r"> اسم العقار</td>
            </tr>
            <tr class="data-row">
                <td class="l"> </td>
            </tr>
            <tr class="data-row">
                <td class="l"> ابو فادي </td>
                <td class="r"> صاحب العقار</td>
            </tr>
            <tr class="data-row">
                <td class="l"></td>
            </tr>

            <tr class="data-row">
                <td class="l">فيلا </td>
                <td class="r"> نوع العقار </td>
            </tr>

            <tr class="data-row">
                <td class="l"></td>

            </tr>


            <tr class="data-row">
                <td class="l">يومي</td>
                <td class="r">نوع الايجار</td>
            </tr>
            <tr class="data-row">
                <td class="l"></td>
            </tr>

            <tr class="data-row">
                <td class="l"> 100$</td>
                <td class="r">التكلفة</td>
            </tr>

            <tr class="data-row">
                <td class="l"></td>

            </tr>
            <tr class="data-row">
                <td class="l">يوجد</td>
                <td class="r">المنامة</td>
            </tr>

            <tr class="data-row">
                <td class="l"></td>
            </tr>

            <tr class="data-row">
                <td class="l"> 10:00 am </td>
                <td class="r">التسليم والاستلام </td>
            </tr>



            <tr class="data-row">
                <td class="l"></td>
            </tr>
            <tr class="data-row">
                <td class="l"> 2</td>
                <td class="r">عدد الطوابق </td>
            </tr>
            <tr class="data-row">
                <td class="l"></td>
            </tr>
            <tr class="data-row">
                <td class="l"> 4</td>
                <td class="r">عدد الغرف </td>
            </tr>

            <tr class="data-row">
                <td class="l"></td>
            </tr>


            <tr class="data-row">
                <td class="l"> ريف دمشق ,بلودان , جانب مغارة موسى</td>

                <td class="r">الموقع </td>

            </tr>


        </table>


    </div>
    <script>
        window.addEventListener('scroll', function() {
            const rows = document.querySelectorAll('.info-table tbody tr');
            rows.forEach((row) => {
                const rowPosition = row.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;

                // إذا كان الصف في نطاق العرض
                if (rowPosition < windowHeight && rowPosition > 0) {
                    row.style.opacity = '1'; // جعل الصف مرئي
                    row.style.transform = 'translateX(0)'; // إنهاء الحركة
                }
            });
        });

        // إعدادات أولية لجعل الصفوف غير مرئية في البداية
        const rows = document.querySelectorAll('.info-table tbody tr');
        rows.forEach(row => {
            row.style.opacity = '0'; // جعل الصف غير مرئي
            row.style.transform = 'translateX(-100px)'; // بدء الحركة من اليسار
        });
    </script>
    <!--/*===================  more-info ==================*/-->

    <div class="more-info">
        <h2 class="more-info-word"> : معلومات اضافية </h2>
        <div class="more-info-box">
            <ul class="more-info-list">
                <li>طاقة شمسية</li>
                <li> كهرباء 24 ساعة</li>
                <li> ساونا</li>
            </ul>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const moreInfoBox = document.querySelector('.more-info-box');

            function checkVisibility() {
                const boxPosition = moreInfoBox.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;

                // إذا كانت العنصر في نطاق العرض
                if (boxPosition < windowHeight && boxPosition > 0) {
                    moreInfoBox.classList.add('visible'); // إضافة الفئة لجعل العنصر مرئي
                }
            }

            // التحقق عند التمرير
            window.addEventListener('scroll', checkVisibility);

            // التحقق عند تحميل الصفحة
            checkVisibility();
        });
    </script>
<!--hiii-->

    <div class="rate">
        <h2 class="rate-word">: المراجعات</h2>
        <div class="rate-box">
            <div class="stars-container">
                <!-- Favorite heart -->
                <div class="heart{% if is_favorite %} red{% endif %}" id="heart" data-id="{{ real_estate.id }}">&#10084;</div>

                <!-- Stars rating system -->
                <div class="stars">
                    <form method="post" action="{% url 'home:resProfile' slug=real_estate.slug %}">
                        {% csrf_token %}
                        <input type="hidden" name="rating" id="rating-value" value="">
                        <button type="submit" name="rating_submit" class="confirm-button">تقييم</button>
                    </form>
                    <span class="star" data-value="5">&#9733;</span>
                    <span class="star" data-value="4">&#9733;</span>
                    <span class="star" data-value="3">&#9733;</span>
                    <span class="star" data-value="2">&#9733;</span>
                    <span class="star" data-value="1">&#9733;</span>
                </div>
            </div>

            <div class="comments-section">
                <!-- Comment input -->
                <form method="post" action="{% url 'home:resProfile' slug=real_estate.slug %}">
                    {% csrf_token %}
                    <textarea class="comment-input" name="comment_text" placeholder="... اكتب تعليقك هنا "></textarea>
                   <div class="mycomment">
                    <img class="my-comment-profile-img" src="{% static 'photos/prof-icon (2).png' %}" alt="">
                    <button type="submit" name="comment" style="  background-color: #03db3500;
        border: 0;margin-bottom: -3px;">  <img src="{% static 'photos/send.png' %}" alt="send-icon" class="send-icon"></button>
                </div>
                </form>

                <div class="comments-section-section">
                    <h3 class="comments">: التعليقات</h3>

                    <!-- Display comments -->
                    {% for comment in comments %}
                        <div class="othercomments">
                            <div class="other-imgnname">
                                <img class="comment-profile-img" src="{% static 'photos/prof-icon (2).png' %}" alt="">
                                <h4 class="oth-name">{{ comment.user.username }}</h4>
                            </div>
                            <div class="oth-text">{{ comment.text }}</div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Existing scripts and additional content -->

    <!-- JavaScript code -->
    <script>
        // Ensure the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Heart (favorite) functionality
            const heart = document.getElementById('heart');
            heart.addEventListener('click', function() {
                fetch("{% url 'home:resProfile' slug=real_estate.slug %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ 'action': 'toggle_favorite' })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.is_favorite) {
                        heart.classList.add('red');
                    } else {
                        heart.classList.remove('red');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });

            // Stars rating system
            const stars = document.querySelectorAll('.star');
            const ratingValue = document.getElementById('rating-value');

            stars.forEach((star) => {
                star.addEventListener('click', () => {
                    const value = star.dataset.value;
                    ratingValue.value = value;
                    console.log(`Rating value set to: ${value}`);  // Debugging output

                    // Update the UI to reflect the selected rating
                    stars.forEach((s) => {
                        if (s.dataset.value <= value) {
                            s.classList.add('selected-star');
                        } else {
                            s.classList.remove('selected-star');
                        }
                    });
                });
            });

            // Existing code for rateBox visibility
            const rateBox = document.querySelector('.rate-box');
            function checkVisibility() {
                const boxPosition = rateBox.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;

                if (boxPosition < windowHeight && boxPosition > 0) {
                    rateBox.classList.add('visible');
                }
            }

            window.addEventListener('scroll', checkVisibility);
            checkVisibility();

            // Existing code for footer visibility
            const footer = document.querySelector('.endline');
            function checkFooterVisibility() {
                const footerPosition = footer.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;

                if (footerPosition < windowHeight && footerPosition > 0) {
                    footer.classList.add('visible');
                }
            }

            window.addEventListener('scroll', checkFooterVisibility);
            checkFooterVisibility();
        });
    </script>

    <!-- Footer -->
    <footer class="endline">
        <h5>تفاصيل عنا</h5>
        <div class="infa">
            <img src="{% static 'photos/facebook.png' %}" alt="facebook" id="facebook">
            <img src="{% static 'photos/instagram.png' %}" alt="insta" id="insta">
        </div>
    </footer>
</body>
</html>
